<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Destino â€“ RF Driver</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="theme/theme.css">
<link rel="stylesheet" href="theme/layout.css">
<link rel="stylesheet" href="theme/components.css">
</head>

<body>

<!-- HEADER -->
<div class="card highlight" style="text-align:center">
  <h2>Selecionar Destino</h2>
  <p class="muted">Origem definida â€¢ escolha o destino da corrida</p>
</div>

<!-- AÃ‡Ã•ES -->
<div class="grid">
  <div class="card">
    <button class="btn btn-outline" onclick="App.go('origem.html')">
      â—€ Voltar para origem
    </button>
  </div>

  <div class="card">
    <button class="btn btn-outline" onclick="App.go('index.html')">
      ğŸ  InÃ­cio
    </button>
  </div>
</div>

<!-- BUSCA -->
<div class="card">
  <label for="buscaDestino">Destino</label>

  <input
    id="buscaDestino"
    placeholder="Digite o destino (ex: Shopping, RodoviÃ¡ria...)"
    autocomplete="off"
  >

  <div id="listaDestinos" class="card" style="display:none;margin-top:10px;padding:0"></div>
</div>

<!-- AÃ‡ÃƒO PRINCIPAL -->
<div class="card highlight" style="text-align:center">
  <button id="btnContinuar" class="btn btn-primary" disabled>
    Continuar para resumo â†’
  </button>
</div>

<script src="core/global.js"></script>
<script src="core/datamanager.js"></script>

<script>
const origem = App.get("origem");
if (!origem) App.go("index.html");

const input = document.getElementById("buscaDestino");
const lista = document.getElementById("listaDestinos");
const btn = document.getElementById("btnContinuar");

let destinos = [];

async function carregarDestinos(){
  await DataManager.carregar();
  destinos = DataManager.listarDestinos(origem);
}

carregarDestinos();

input.addEventListener("input", () => {
  const termo = input.value.toLowerCase();
  lista.innerHTML = "";

  if (!termo){
    lista.style.display = "none";
    btn.disabled = true;
    return;
  }

  destinos
    .filter(d => d.toLowerCase().includes(termo))
    .forEach(nome => {
      const valor = DataManager.buscarValor(origem, nome);

      const item = document.createElement("div");
      item.style.padding = "12px 16px";
      item.style.cursor = "pointer";
      item.textContent = nome;

      item.onclick = () => {
        input.value = nome;
        App.set("destino", nome);
        App.set("valorBase", valor);
        lista.style.display = "none";
        btn.disabled = false;
      };

      lista.appendChild(item);
    });

  lista.style.display = "block";
});

btn.onclick = () => App.go("resumo.html");
</script>

</body>
</html>