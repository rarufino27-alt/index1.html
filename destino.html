<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Destino - RF Driver</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="theme/theme.css">
<link rel="stylesheet" href="theme/layout.css">
<link rel="stylesheet" href="theme/components.css">

<style>
body{
  min-height:100vh;
  background:radial-gradient(circle at top, #1a1a1a 0%, #000 60%);
  display:flex;
  justify-content:center;
  align-items:center;
  color:#fff;
}
.container{
  width:100%;
  max-width:560px;
  padding:35px 30px;
  background:linear-gradient(145deg, rgba(20,20,20,.95), rgba(0,0,0,.85));
  border-radius:22px;
  box-shadow:0 0 40px rgba(255,215,120,.25);
}
.app-header{text-align:center;margin-bottom:22px}
.app-header h1{
  font-size:2rem;
  letter-spacing:2px;
  background:linear-gradient(90deg,#d4af37,#f5e28c,#c9a227);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:10px;
}
.steps{
  display:flex;justify-content:center;gap:14px;font-size:.9rem
}
.step{display:flex;align-items:center;gap:6px;opacity:.4}
.step.done{opacity:.8}
.step.active{opacity:1;font-weight:600}
.step span{
  width:18px;height:18px;border-radius:50%;
  background:#f5c542;color:#000;
  font-size:.75rem;line-height:18px;text-align:center
}
.step.done span{background:#1db954}
.search-wrapper{position:relative}
.search-input{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid rgba(255,215,120,.25);
  background:rgba(0,0,0,.4);
  color:#fff;
  font-size:1rem;
}
.search-results{
  position:absolute;top:105%;left:0;right:0;
  background:#0f0f0f;border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.6);
  max-height:240px;overflow:auto;display:none;z-index:5
}
.search-results div{
  padding:12px 16px;cursor:pointer
}
.search-results div:hover{
  background:rgba(245,197,66,.15)
}
.actions{margin-bottom:15px;display:flex;gap:10px}
</style>
</head>

<body>

<div class="container">

  <div class="app-header">
    <h1>RF DRIVER</h1>
    <div class="steps">
      <div class="step done"><span>‚úì</span> Origem</div>
      <div class="step active"><span>2</span> Destino</div>
      <div class="step"><span>3</span> Resumo</div>
    </div>
  </div>

  <div class="actions">
    <button class="btn btn-secondary" onclick="App.go('origem.html')">‚óÄ Voltar</button>
    <button class="btn btn-secondary" onclick="App.go('index.html')">üè† In√≠cio</button>
  </div>

  <label>Digite o destino</label>
  <div class="search-wrapper">
    <input
      type="text"
      id="buscaDestino"
      class="search-input"
      placeholder="Ex: Shopping, Rodovi√°ria..."
      autocomplete="off"
    >
    <div id="listaDestinos" class="search-results"></div>
  </div>

  <button id="btnContinuar" class="btn btn-primary" disabled style="margin-top:20px">
    Continuar
  </button>

</div>

<!-- SCRIPTS CENTRAIS -->
<script src="core/global.js"></script>
<script src="core/datamanager.js"></script>

<script>
/* ===============================
   PROTE√á√ÉO DE FLUXO
================================ */
const origem = App.get("origem");
if (!origem) {
  App.go("index.html");
}

/* ===============================
   BUSCA DE DESTINOS (CORRIGIDA)
================================ */
const input = document.getElementById("buscaDestino");
const lista = document.getElementById("listaDestinos");
const btn = document.getElementById("btnContinuar");

let destinos = [];

(async function(){
  const tabela = await DataManager.getTabela();
  destinos = tabela.filter(item => item.origem === origem);

  if (!destinos.length) {
    console.warn("Nenhum destino encontrado para a origem:", origem);
  }
})();

input.addEventListener("input", () => {
  const termo = input.value.toLowerCase();
  lista.innerHTML = "";

  if (!termo) {
    lista.style.display = "none";
    btn.disabled = true;
    return;
  }

  destinos
    .filter(item => item.destino.toLowerCase().includes(termo))
    .forEach(item => {
      const div = document.createElement("div");
      div.textContent =
        `${item.destino} ‚Äî R$ ${Number(item.valor).toFixed(2).replace('.', ',')}`;

      div.onclick = () => {
        input.value = item.destino;
        App.set("destino", item.destino);
        App.set("valorBase", Number(item.valor));
        lista.style.display = "none";
        btn.disabled = false;
      };

      lista.appendChild(div);
    });

  lista.style.display = lista.children.length ? "block" : "none";
});

btn.onclick = () => {
  App.go("resumo.html");
};
</script>

</body>
</html>