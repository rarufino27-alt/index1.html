<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Resumo â€“ RF Driver</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="theme/theme.css">
<link rel="stylesheet" href="theme/layout.css">
<link rel="stylesheet" href="theme/components.css">

<style>
/* ===== AJUSTES PREMIUM DO RESUMO ===== */

.page{
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:20px;
}

.box{
  width:100%;
  max-width:420px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* TOTAL COM PRESENÃ‡A */
.total{
  font-size:2.3rem;
  font-weight:800;
  color:var(--gold);
  letter-spacing:1px;
  margin-bottom:4px;
}
.total::after{
  content:"valor final";
  display:block;
  font-size:.7rem;
  color:var(--text-muted);
  letter-spacing:2px;
  margin-top:4px;
}

/* QUADRANTES DE TAXA */
.taxa-card{
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  transition:all .25s ease;
}

.taxa-card label{
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
}

.taxa-card.active{
  border-color:var(--gold);
  background:linear-gradient(
    180deg,
    rgba(212,175,55,.18),
    rgba(23,26,33,.95)
  );
  box-shadow:0 8px 22px rgba(212,175,55,.25);
  transform:scale(1.02);
}

@keyframes pulseGold{
  0%{box-shadow:0 0 0 rgba(212,175,55,0)}
  50%{box-shadow:0 0 22px rgba(212,175,55,.45)}
  100%{box-shadow:0 0 0 rgba(212,175,55,0)}
}

.taxa-card.pulse{
  animation:pulseGold .35s ease;
}
</style>
</head>

<body>

<div class="page">
<div class="box">

<!-- HEADER -->
<div class="card highlight" style="text-align:center">
  <h2>OrÃ§amento de Viagem</h2>
  <p class="muted">Valor calculado com base nas opÃ§Ãµes selecionadas</p>
</div>

<!-- CONTEXTO -->
<div class="card" style="text-align:center">
  <p class="muted">ğŸ“ŒğŸ›« Origem ou Destino</p>
  <strong id="origemTxt"></strong>

  <p class="muted" style="margin-top:8px">ğŸ›«ğŸ“Œ Destino ou Origem</p>
  <strong id="destinoTxt"></strong>
</div>

<!-- TIPO DE VIAGEM -->
<div class="card">
  <h3>Tipo de viagem</h3>
  <select id="tipoViagem">
    <option value="ida">Ida</option>
    <option value="bate_volta">Bate e volta (viagem rÃ¡pida)</option>
    <option value="ida_volta">Ida e volta (atÃ© 1h)</option>
    <option value="ida_volta_espera">Ida e volta (acima de 1h)</option>
  </select>
</div>

<!-- TAXAS COM ANIMAÃ‡ÃƒO -->
<div class="card">
  <h3>Adicionais</h3>

  <div class="taxas-grid">

    <div class="taxa-card">
      <label>
        <span class="taxa-icon">ğŸ‘¥</span>
        <span class="taxa-text">Excesso de pessoas</span>
        <input type="checkbox" id="excessoPessoas">
      </label>
    </div>

    <div class="taxa-card">
      <label>
        <span class="taxa-icon">â›±ï¸</span>
        <span class="taxa-text">Volta das praias</span>
        <input type="checkbox" id="voltaPraia">
      </label>
    </div>

    <div class="taxa-card">
      <label>
        <span class="taxa-icon">ğŸ›£ï¸</span>
        <span class="taxa-text">Desvio de rota simples</span>
        <input type="checkbox" id="desvioSimples">
      </label>
    </div>

  </div>
</div>

<!-- ANIMAL -->
<div class="card">
  <h3>Transporte de animal</h3>
  <select id="animal">
    <option value="0">Nenhum</option>
    <option value="5">Pequeno</option>
    <option value="7">MÃ©dio</option>
    <option value="10">Grande</option>
    <option value="20">Viagem longa</option>
  </select>
</div>

<!-- ESPERA -->
<div class="card">
  <h3>Desvio com espera</h3>
  <input
    type="number"
    id="minutosEspera"
    min="0"
    placeholder="Minutos de espera"
  >
</div>

<!-- DETALHAMENTO -->
<div class="card">
  <h3>Detalhamento</h3>
  <div id="detalhamento" class="muted"></div>
</div>

<!-- TOTAL -->
<div class="card highlight" style="text-align:center">
  <div class="total" id="total">R$ 0,00</div>
  <button class="btn btn-primary" onclick="enviarWhats()">
    ğŸ“¤ Enviar orÃ§amento no WhatsApp
  </button>
</div>

<!-- AÃ‡Ã•ES -->
<div class="grid">
  <div class="card">
    <button class="btn btn-outline" onclick="voltarDestino()">â—€ Voltar</button>
  </div>
  <div class="card">
    <button class="btn btn-outline" onclick="novoPreco()">ğŸ”„ Novo cÃ¡lculo</button>
  </div>
</div>

</div>
</div>

<script src="core/global.js"></script>

<script>
const origem = App.get("origem");
const destino = App.get("destino");

document.getElementById("origemTxt").innerText = origem;
document.getElementById("destinoTxt").innerText = destino;

const valorBaseOriginal = Number(App.get("valorBase") || 0);

const tipoViagem = document.getElementById("tipoViagem");
const excessoPessoas = document.getElementById("excessoPessoas");
const voltaPraia = document.getElementById("voltaPraia");
const desvioSimples = document.getElementById("desvioSimples");
const animalSel = document.getElementById("animal");
const minutosEspera = document.getElementById("minutosEspera");
const totalDiv = document.getElementById("total");
const detalheDiv = document.getElementById("detalhamento");

/* ANIMAÃ‡ÃƒO DOS QUADRANTES */
document.querySelectorAll(".taxa-card input").forEach(input => {
  const card = input.closest(".taxa-card");
  input.addEventListener("change", () => {
    if(input.checked){
      card.classList.add("active","pulse");
      setTimeout(()=>card.classList.remove("pulse"),350);
    }else{
      card.classList.remove("active");
    }
    calcular();
  });
});

function calcular(){
  let total = valorBaseOriginal;
  let detalhes = [];

  detalhes.push(`ğŸš• Viagem base: R$ ${valorBaseOriginal.toFixed(2)}`);

  const tipo = tipoViagem.value;
  if(tipo==="bate_volta"){ total*=1.8; detalhes.push("ğŸ” Bate e volta"); }
  if(tipo==="ida_volta"){ total*=2; detalhes.push("ğŸ” Ida e volta"); }
  if(tipo==="ida_volta_espera"){ total=(total*2)*1.1; detalhes.push("â³ Ida e volta com espera"); }

  if(excessoPessoas.checked){
    const taxa = total < 30 ? 5 : total*0.5;
    total+=taxa;
    detalhes.push(`ğŸ‘¥ Excesso de pessoas: R$ ${taxa.toFixed(2)}`);
  }

  if(voltaPraia.checked){
    total+=10;
    detalhes.push("â›±ï¸ Volta das praias: R$ 10.00");
  }

  if(desvioSimples.checked){
    total+=5;
    detalhes.push("ğŸ›£ï¸ Desvio de rota: R$ 5.00");
  }

  const h=new Date().getHours(), m=new Date().getMinutes();
  if(h>22||(h===22&&m>=30)||h<5){
    const taxa = total < 30 ? 5 : total*0.35;
    total+=taxa;
    detalhes.push(`ğŸŒ™ Adicional noturno: R$ ${taxa.toFixed(2)}`);
  }

  const animal=Number(animalSel.value);
  if(animal>0){
    total+=animal;
    detalhes.push(`ğŸ¶ Transporte de animal: R$ ${animal.toFixed(2)}`);
  }

  const min=Number(minutosEspera.value||0);
  if(min>=5){
    const taxa=Math.floor(min/5)*3;
    total+=taxa;
    detalhes.push(`â±ï¸ Espera (${min} min): R$ ${taxa.toFixed(2)}`);
  }

  App.set("total", total);
  totalDiv.innerText = `R$ ${total.toFixed(2)}`;
  detalheDiv.innerHTML = detalhes.join("<br>");
}

document.querySelectorAll("select,input").forEach(e=>{
  if(e.type!=="checkbox") e.addEventListener("change",calcular);
});

calcular();

function enviarWhats(){
  const msg =
`ğŸš– *OrÃ§amento RF Driver*

ğŸ“Œ Origem: ${origem}
ğŸ›« Destino: ${destino}

âœğŸ½ *Detalhamento*
${detalheDiv.innerText}

ğŸ’¸ *Total*: R$ ${App.get("total").toFixed(2)}`;

  window.open("https://wa.me/?text="+encodeURIComponent(msg),"_blank");
}

function voltarDestino(){ App.go("destino.html"); }
function novoPreco(){ localStorage.clear(); App.go("origem.html"); }
</script>

</body>
</html>
