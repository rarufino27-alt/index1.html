<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Resumo da Corrida - RF Driver</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="theme/theme.css">
<link rel="stylesheet" href="theme/layout.css">
<link rel="stylesheet" href="theme/components.css">

<style>
/* FUNDO PREMIUM */
body{
  min-height:100vh;
  background:radial-gradient(circle at top, #1a1a1a 0%, #000 60%);
  display:flex;
  justify-content:center;
  align-items:center;
  color:#fff;
}

/* CONTAINER CENTRAL */
.container{
  position:relative;
  width:100%;
  max-width:720px;
  padding:35px 30px;
  background:linear-gradient(145deg, rgba(20,20,20,.95), rgba(0,0,0,.85));
  border-radius:22px;
  box-shadow:0 0 40px rgba(255,215,120,.25);
}

/* HEADER */
.app-header{
  text-align:center;
  margin-bottom:25px;
}

.app-header h1{
  font-size:2rem;
  letter-spacing:2px;
  background:linear-gradient(90deg,#d4af37,#f5e28c,#c9a227);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:12px;
}

/* ETAPAS */
.steps{
  display:flex;
  justify-content:center;
  gap:14px;
  font-size:.9rem;
}

.step{
  display:flex;
  align-items:center;
  gap:6px;
  opacity:.4;
}

.step.done{opacity:.8}
.step.active{opacity:1;font-weight:600}

.step span{
  width:18px;
  height:18px;
  border-radius:50%;
  background:#555;
  font-size:.75rem;
  line-height:18px;
  text-align:center;
}

.step.done span{background:#1db954}
.step.active span{background:#f5c542}

/* AÃ‡Ã•ES */
.top-actions{
  display:flex;
  gap:10px;
  margin-bottom:18px;
  justify-content:center;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:12px;
}

.highlight{
  border:2px solid var(--success);
  background:var(--success-soft);
}

.total{
  font-size:24px;
  font-weight:800;
  text-align:right;
}

.muted{
  color:var(--muted);
  font-size:13px;
}

.whatsapp{
  background:#25d366;
}
</style>
</head>

<body>

<div class="container">

  <!-- HEADER -->
  <div class="app-header">
    <h1>RF DRIVER</h1>
    <div class="steps">
      <div class="step done"><span>âœ“</span> Origem</div>
      <div class="step done"><span>âœ“</span> Destino</div>
      <div class="step active"><span>3</span> Resumo</div>
    </div>
  </div>

  <!-- AÃ‡Ã•ES -->
  <div class="top-actions">
    <button class="btn btn-secondary" onclick="App.go('origem.html')">ğŸ”„ Nova cotaÃ§Ã£o</button>
    <button class="btn btn-secondary" onclick="App.go('index.html')">ğŸ  InÃ­cio</button>
  </div>

  <!-- ROTA -->
  <div class="card">
    <p id="rota"></p>
    <p id="horaAtual" class="muted"></p>
  </div>

  <!-- BASE -->
  <div class="card">
    <p id="valorBaseOriginal"></p>
    <p id="valorBaseCalculado"></p>
  </div>

  <!-- IDA E VOLTA -->
  <div class="card">
    <label>
      <input type="checkbox" id="idaVolta">
      Corrida ida e volta
    </label>
  </div>

  <!-- TAXAS -->
  <h3>Taxas adicionais</h3>
  <div class="grid">

    <div class="card">
      <label><input type="checkbox" id="saidaPraia"> ğŸ–ï¸ SaÃ­da de praias (+ R$ 10)</label>
      <p class="muted">Domingos e feriados</p>
    </div>

    <div class="card">
      <label><input type="checkbox" id="taxaFeira"> ğŸ›’ SaÃ­da de feira (+ R$ 5)</label>
    </div>

    <div class="card">
      <label><input type="checkbox" id="taxaExcesso"> ğŸ‘¥ Excesso de pessoas</label>
    </div>

    <div class="card">
      <strong>ğŸ¾ Animal</strong>
      <label><input type="radio" name="animal" value=""> Nenhum</label>
      <label><input type="radio" name="animal" value="pequeno"> Pequeno</label>
      <label><input type="radio" name="animal" value="medio"> MÃ©dio</label>
      <label><input type="radio" name="animal" value="grande"> Grande</label>
    </div>

    <div class="card">
      <label><input type="checkbox" id="buscaLonge"> ğŸ“ Buscar passageiro longe</label>
    </div>

  </div>

  <!-- DESVIOS -->
  <h3>Desvio de rota</h3>
  <div class="grid">

    <div class="card">
      <label><input type="checkbox" id="desvioSimples"> ğŸ”€ Desvio simples</label>
    </div>

    <div class="card">
      <label><input type="checkbox" id="desvioEspera"> â±ï¸ Desvio com espera</label>
      <input type="number" id="tempoEspera" placeholder="Minutos">
    </div>

    <div class="card">
      <strong>â• MÃºltiplos trechos</strong>
      <input type="text" id="trechos" placeholder="Ex: 10,10">
    </div>

  </div>

  <!-- DETALHAMENTO -->
  <h3>Detalhamento da cobranÃ§a</h3>
  <div class="card">
    <ul id="listaDetalhes"></ul>
    <p id="nenhumaTaxa" class="muted"></p>
  </div>

  <!-- RESULTADO -->
  <h3>Resultado</h3>
  <div class="card">
    <p class="total" id="total"></p>
    <p id="restante"></p>
    <button class="btn btn-primary whatsapp" onclick="enviarWhatsApp()">
      ğŸ“² Enviar no WhatsApp
    </button>
  </div>

</div>

<script src="core/global.js"></script>
<script src="js/calculo.js"></script>

<script>
/* ===============================
   RESUMO â€” RF DRIVER
================================ */

const { origem, destino, valorBase } = App.state;
if (!origem || !destino) App.go("index.html");

const rota = document.getElementById("rota");
const horaAtual = document.getElementById("horaAtual");

const idaVolta = document.getElementById("idaVolta");
const taxaFeira = document.getElementById("taxaFeira");
const taxaExcesso = document.getElementById("taxaExcesso");
const buscaLonge = document.getElementById("buscaLonge");
const saidaPraia = document.getElementById("saidaPraia");

const desvioSimples = document.getElementById("desvioSimples");
const desvioEspera = document.getElementById("desvioEspera");
const tempoEspera = document.getElementById("tempoEspera");
const trechos = document.getElementById("trechos");

const valorBaseOriginal = document.getElementById("valorBaseOriginal");
const valorBaseCalculado = document.getElementById("valorBaseCalculado");
const listaDetalhes = document.getElementById("listaDetalhes");
const nenhumaTaxa = document.getElementById("nenhumaTaxa");
const total = document.getElementById("total");
const restante = document.getElementById("restante");

rota.textContent = `ğŸš— ${origem} â†’ ${destino}`;
horaAtual.textContent = new Date().toLocaleString();

document.querySelectorAll("input").forEach(i =>
  i.addEventListener("change", atualizar)
);

/* UX VISUAL */
document.querySelectorAll(".card input").forEach(input => {
  const card = input.closest(".card");
  function marcar(){
    if (input.type === "checkbox") card.classList.toggle("highlight", input.checked);
    if (input.type === "radio") {
      document.querySelectorAll(`input[name="${input.name}"]`)
        .forEach(r => r.closest(".card")?.classList.remove("highlight"));
      if (input.checked) card.classList.add("highlight");
    }
  }
  marcar();
  input.addEventListener("change", marcar);
});

function atualizar(){

  const taxas = {
    idaVolta: idaVolta.checked,
    feira: taxaFeira.checked,
    excessoPessoas: taxaExcesso.checked,
    animal: document.querySelector("input[name='animal']:checked")?.value || null,
    buscaLonge: buscaLonge.checked,
    saidaPraia: saidaPraia.checked,
    desvioSimples: desvioSimples.checked,
    desvioComEspera: desvioEspera.checked,
    tempoEspera: Number(tempoEspera.value || 0),
    desvioTrechos: trechos.value
      ? trechos.value.split(",").map(v => Number(v.trim()))
      : []
  };

  const r = Calculo.calcularTotal({ valorBase, taxas });

  valorBaseOriginal.textContent = `Valor base: R$ ${r.valorBaseOriginal.toFixed(2)}`;
  valorBaseCalculado.textContent =
    r.valorBaseCalculado !== r.valorBaseOriginal
      ? `Base ajustada: R$ ${r.valorBaseCalculado.toFixed(2)}`
      : "";

  listaDetalhes.innerHTML = "";
  let tem = false;

  function add(nome, valor){
    const li = document.createElement("li");
    li.textContent = `${nome}: R$ ${valor.toFixed(2)}`;
    listaDetalhes.appendChild(li);
    tem = true;
  }

  if (taxas.feira) add("ğŸ›’ SaÃ­da de feira", 5);
  if (taxas.saidaPraia) add("ğŸ–ï¸ SaÃ­da de praias", 10);
  if (taxas.excessoPessoas)
    add("ğŸ‘¥ Excesso de pessoas", valorBase <= 30 ? 5 : valorBase * 0.5);
  if (taxas.animal){
    const map = {pequeno:5, medio:7, grande:10};
    add(`ğŸ¾ Animal (${taxas.animal})`, map[taxas.animal]);
  }
  if (taxas.desvioSimples) add("ğŸ”€ Desvio simples", 5);
  if (taxas.desvioComEspera && taxas.tempoEspera >= 5) add("â±ï¸ Desvio com espera", 10);
  if (taxas.desvioTrechos.length)
    add("â• MÃºltiplos trechos", taxas.desvioTrechos.reduce((a,b)=>a+b,0));

  nenhumaTaxa.textContent = tem ? "" : "Nenhuma taxa adicional aplicada";

  total.textContent = `Total: R$ ${r.totalFinal.toFixed(2)}`;
  restante.textContent = `A receber: R$ ${r.valorRestante.toFixed(2)}`;

  window.__mensagemWhats = `
ğŸš– *Corrida RF Driver* ğŸš–

ğŸ“Œ Origem: ${origem}
ğŸ›« Destino: ${destino}

ğŸ“Š *Taxas adicionais*
${listaDetalhes.innerText || "Sem taxas adicionais"}

ğŸ’µ *Total*: R$ ${r.totalFinal.toFixed(2)}
`;
}

function enviarWhatsApp(){
  const txt = encodeURIComponent(window.__mensagemWhats);
  window.open(`https://wa.me/?text=${txt}`, "_blank");
}

atualizar();
</script>

</body>
</html>
